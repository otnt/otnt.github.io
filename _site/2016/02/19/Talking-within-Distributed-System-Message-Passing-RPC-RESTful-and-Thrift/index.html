<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Pufan Jiang's personal blog, including lots of tech blogs, photo shooting etc.">
    <meta name="keyword"  content="tech | software">
    <link rel="shortcut icon" href="img/favicon.ico">

    <title>Talking within Distributed System - Pufan Jiang | 江浦饭</title>

    <link rel="canonical" href="http://huangxuan.me/2016/02/19/Talking-within-Distributed-System-Message-Passing-RPC-RESTful-and-Thrift/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="http://cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Pufan Jiang's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About Me</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/post-2016-02-11-poison-pill-pattern.jpg" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/post-2016-02-11-poison-pill-pattern.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#Distributed System" title="Distributed System">Distributed System</a>
                        
                        <a class="tag" href="/tags/#Network" title="Network">Network</a>
                        
                        <a class="tag" href="/tags/#Communication" title="Communication">Communication</a>
                        
                        <a class="tag" href="/tags/#Message Passing" title="Message Passing">Message Passing</a>
                        
                        <a class="tag" href="/tags/#RPC" title="RPC">RPC</a>
                        
                        <a class="tag" href="/tags/#Remote Procedure Call" title="Remote Procedure Call">Remote Procedure Call</a>
                        
                        <a class="tag" href="/tags/#RESTful" title="RESTful">RESTful</a>
                        
                        <a class="tag" href="/tags/#Thrift" title="Thrift">Thrift</a>
                        
                    </div>
                    <h1>Talking within Distributed System</h1>
                    
                    
                    <h2 class="subheading">Message Passing, RPC, RESTful and Thrift</h2>
                    
                    <span class="meta">Posted by Pufan Jiang on February 19, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

				<blockquote>
  <p>This is a short series about some important concepts in distributed system.</p>
</blockquote>

<h2 id="tldr">TL;DR;</h2>

<p>In this article, I first tried to explain what’s difference between communication in distributed system and local machine.</p>

<p>Then I talked about two most popular way to communicate within a distributed system, i.e. message passing and RPC, and analyzed the advantages and disadvantages of them.</p>

<p>Finally, I introduced two most successful protocol using these two communication idea, i.e. RESTful and Thrift.</p>

<h2 id="why-talking-within-distributed-system-is-different-from-local-machine">Why talking within distributed system is different from local machine?</h2>

<p>In a local machine, when process A is communicating with process B, it could be done in a synchronized fashion guaranteed by electrical circuit or the so-called bus built in your laptop or server. So the delivery time is always constant, corresponding to several clock cycles.</p>

<p>The fundamental difference of distributed system and local machine is due to network unreliability. When machine A is sending message to or call function at machine B, there is not such bus connecting them so that they could only communicate through network. So either machine A get an acknowledgement message and it could be sure that machine B receive the message, or it has to wait indefinitely since it could never tell whether the message is lost or it is network congestion.</p>

<p>So it is the case that I know what I know, but I don’t know what others know, and I don’t know what others know others know…</p>

<h2 id="an-example">An example</h2>

<p>Through the next of this post, we will examine a simple common example <code>distcp</code>. So the semantic of <code>distcp</code> is the same as <code>cp</code> (copy) method, it copies data from one location to another.</p>

<p>More specifically, when machine A runs <code>distcp path1/file path2</code>, it copy <code>file</code> from <code>path1</code> to <code>path2</code>.</p>

<h2 id="message-passing">Message Passing</h2>

<p>So message passing is actually the most straightforward and also most widely used way to implement distributed system communication (think about Internet!).</p>

<p>Message Passing defines two basic method, <strong>send()</strong> and <strong>receive()</strong>.  It sends the whole information including operator (in our case it is <code>distcp</code>) and operands (in our case it is <code>file</code> and <code>path</code>) through network. And when receiver receives the message, it lookups the operator and finds corresponding local method and then finishes the job.</p>

<p><strong>Advantages</strong></p>

<p>It is straightforward/user-friendly.</p>

<p><strong>Disadvantages</strong></p>

<p>However, despite the good point of message passing, this method leaves a lot of burden to application programmer. A common message passing is very like this:<br />
On sender’s side:</p>

<pre><code>MessageFactor.createMessage("distcp").setArgument(0, "path1/file").setArgument(1, "path2").send(ip of machine B)
</code></pre>

<p>On receiver’s side:</p>

<pre><code>operator = receive().getOperator();
switch(operator) {
	case "distcp": copy to path; break;
}
</code></pre>

<p>There are two obvious problem.<br />
1.Programmer needs to do lots of work to control the logic, especially on receiver’s side.<br />
2.The program could not make use of compile check to make sure the sending message is correct. This significantly increase the possibility of runtime error.</p>

<h2 id="remote-procedure-call-rpc">Remote Procedure Call (RPC)</h2>

<p>So to reduce the burden of programmers and make our program more predictable, RPC is a good idea.</p>

<p>The core idea of RPC is to provide an interface for both local and remote procedure call, so that programmer could call remote function just like call local function.</p>

<p>So the RPC way of our function is very like to be this:</p>

<pre><code>register_path("path1", ip of machine A);
register_path("path2", ip of machine B);
dist("path1/file", "path2");
</code></pre>

<p>And it is done! How to find the file and how to bind the data is left to RPC service. After binding the path and machine, the programmer doesn’t need to worry about the whole logic. Moreover, now we could at compile time check whether the programmer provides exactly two arguments , reducing runtime error.</p>

<p>Also, it a lot of distributed system, e.g. Hadoop platform, there’s a master machine to take care of path binding, so the two <code>register_path</code> method could be avoided as well!</p>

<p><strong>Note</strong> To understand how the RPC service is implemented, I encourage you to further read some posts online or this paper <a href="http://doi.acm.org/10.1145/2080.357392">Implementing remote procedure calls</a> by Andrew and Bruce.</p>

<p><strong>Advantages</strong></p>

<p>1.RPC provide the abstraction of procedure call so that programmers could use these services easily just as using local methods.<br />
2.It also helps reducing runtime errors.</p>

<p><strong>Disadvantages</strong><br />
Now RPC may seems really attracting, it has one important disadvantages compared to message passing – the service itself is much complicated.</p>

<p>Yes, the user/programmer is relieved from handling logic and data binding themselves, but the API provider/RPC service provider need to do a lot of work, including defining interface, implementing logic etc. The complication is significant when testing some new functions, since the API may change frequently during development.</p>

<h2 id="real-world-implementation">Real World Implementation</h2>

<p>Now we scratched the surface of both two common communication ways, how and when do we prefer one to the other? Let’s see two most widely used communication protocol in web service today.</p>

<h3 id="restful">RESTful</h3>

<p>I’m not going to talk about what is RESTful. I assume you have already know what it is and hopefully you have used it several times in your previous projects.</p>

<p>RESTful is a good example using the idea of message passing. For <strong>send()</strong> method, it supports four operators, i.e. GET, PUT, POST and DELETE, and nearly unlimited number of operands (within bound of network limit of course). And <strong>receive()</strong> method is handled by HTTP request.</p>

<p><strong>Advantages</strong><br />
1.Lightweight. Since RESTful API is often used for implementing CRUD operations in database, so the message is generally short.<br />
2.User-friendly. RESTful has same semantics with HTTP request, thus learning curve of RESTful is almost zero degree!<br />
3.Language/Platform independence. Since RESTful is nothing but HTTP request, it has no constraints on language or system platform.</p>

<p><strong>Disadvantages</strong><br />
The disadvantage of RESTful stems from HTTP protocol itself.</p>

<p>One thing is RESTful does not support basic method other than HTTP’s methods. Although one could put operator inside body of HTTP request, but that would lose the lightweight property of RESTful.</p>

<p>Another disadvantage is HTTP request is expensive. Each HTTP request is generally a blocking process, harming the scalability of system. (This is said be overcome in HTTP 2.0, I’m not quite familiar with HTTP 2.0, but this disadvantage holds for HTTP 1.1).</p>

<h3 id="thrift">Thrift</h3>

<p>My understanding of Thrift may not be correct and well-rounded, since I haven’t use Thrift a lot. But generally, Thrift is a protocol based on RPC so that to simplify remote call process and with goal of a fast, reliable and safe communication.</p>

<p>To use Thrift, you need first define the RPC interface using Interface Definition Language (IDL). This interface is a constraint that both server and clients using the method should follow. After you defined the interface, it is Thrift that will take care of the underlying communication and compile time checking.</p>

<p><strong>Advantages</strong><br />
1.Provide compile time checking. Thrift is much stricter than RESTful, but the goodness is it could help avoid lots of small errors.<br />
2.It is faaaaast. RPC generally take advantages of UDP protocol and binding acknowledgement message with next request to avoid overhead and amount of exchanging data.</p>

<p><strong>Disadvantages</strong><br />
It is obvious that Thrift is way complicated than RESTful API. It also doesn’t have a universal method name (e.g. GET in RESTful). Therefore developers need to first learn the interface of different Thrift library then could they move on.</p>

<h2 id="discussion">Discussion</h2>

<p>So how to choose among them? Like most design in computer science, there is no absolute yes or no to choose one protocol rather than the other.</p>

<p>It has been a consensus that, generally, when developing light-weight api, especially those similar with CRUD operations, and when your api is used by lots of users, then RESTful may be better choice. While developing api that is internally used, or logically complicated, or fast is your first priority, then Thrift may be better.</p>

<p>In comparison these protocol, here is a great <a href="http://nordicapis.com/microservice-showdown-rest-vs-soap-vs-apache-thrift-and-why-it-matters/">article</a> by Kristopher  Sandoval. I quote part of the article here, but you should definitely read through that great post.</p>

<blockquote>
  <p>REST, on the other hand, is like a pre-paid postcard. You’ve forgone the envelope in favor of a lightweight, succinct delivery device that is easy to interpret and handle, with your message quickly scribbled on the back. The postcard uses less material (bandwidth), is typically shorter in content, and might actually get to your neighbor faster because there’s less bulk to move around.</p>
</blockquote>

<blockquote>
  <p>Thrift is like a megaphone. When you point the megaphone at your neighbor, he implicitly knows you’re upset about something — and that you’re going to say it specifically to him. He knows what to do with the information, because the reaction a human has to a megaphone is pretty universal (assuming, of course, that your megaphone is louder than his drums). The message is sent in a lightweight but forceful manner that depends entirely on the receiver to properly process it, in this case your neighbor.</p>
</blockquote>


                <hr>

                


                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2016/02/14/Secure-Threats-Buffer-Overflow-Attack-Level-0/" data-toggle="tooltip" data-placement="top" title="Secure Threats -- Buffer Overflow Attack -- Level 0">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2016/02/19/Cracking-Code-Challenge-The-Hard-Way-Introduction/" data-toggle="tooltip" data-placement="top" title="Cracking Code Challenge The Hard Way - Introduction">Next Post &rarr;</a>
                    </li>
                    
                </ul>


                

                

            </div>

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#Code Challenge" title="Code Challenge" rel="2">
                                    Code Challenge
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a href="http://blog.csdn.net/jiangfan2014">My CSDN Blog</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/jiangpufan">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    
                    


                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/otnt">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Pufan Jiang's Blog 2016
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- Highlight.js -->
<script>
    async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
        hljs.initHighlightingOnLoad();
    })
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>
<link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">

<!--fastClick.js -->
<script>
    async("http://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-73727812-1';
    var _gaDomain = 'otnt.github.io';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->




<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
